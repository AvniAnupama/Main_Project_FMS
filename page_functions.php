<?php function CreateFilesToPages($ModuleName,$pageName,$dataArray,$obj){$folderPath="../".$ModuleName."";$jsFile=CreatePageJsFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj);CreateTableForThisPage($ModuleName,$pageName,$dataArray,$obj);CreateFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj);CreateActionFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj);CreatePageFileInsidePublicFolder($ModuleName,$pageName,$jsFile);AddPagesUrlToHtaccessFile($ModuleName,$pageName);}function CreatePageJsFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$ModuleUrl=str_replace(" ","-",$ModuleName).".php";$PageName_with_out_gap=str_replace(" ","_",$pageName);$name=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$TableID=$ModuleName_with_out_gap."_".$PageName_with_out_gap."_id";$TableNameToAdd="tbl_".strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;$name.=".js";$fileName="../".$ModuleName."/js/".$name."";$JsVariableData=getFileDataPage('../pages/pageTemplates/JsVariablesFromFormData.php');$JsVariableDataCheckBox=getFileDataPage('../pages/pageTemplates/JsVariablesCheckBoxFormData.php');$JsVariableDataFile=getFileDataPage('../pages/pageTemplates/JsVariablesFileFormData.php');$JsVariablesFromFormDataSelect=getFileDataPage('../pages/pageTemplates/JsVariablesFromFormDataSelect.php');$JsVariableDataPlaceHolder="";$ComponnetNameWithDashCommaSeparated="";$RichTextBoxFlag=0;foreach($dataArray as $page_data_detaiils_single){foreach($page_data_detaiils_single['component']as $component_single){if($component_single['component_type']=='checkbox'){$contents=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$JsVariableDataCheckBox);}else if($component_single['component_type']=='select'){$contents=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$JsVariablesFromFormDataSelect);}else if($component_single['component_type']=='select_from_existing_table'){$contents=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$JsVariablesFromFormDataSelect);}else if($component_single['component_type']=='image'||$component_single['component_type']=='pdf_Documents'){$contents=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$JsVariableDataFile);}else{$contents=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$JsVariableData);}$ComponnetNameWithDashCommaSeparated.=str_replace(" ","_",$component_single['component_name']).",";$JsVariableDataPlaceHolder.="\n".$contents;}}if(!is_file($fileName)){$contents=getFileDataPage('../pages/pageTemplates/pageJsTemplate.php');$contents=str_replace('**JsVariablesFromFormData**',$JsVariableDataPlaceHolder,$contents);$contents=str_replace('**ComponnetNameWithDashCommaSeparated**',$ComponnetNameWithDashCommaSeparated,$contents);$contents=str_replace('**TableId**',$TableID,$contents);file_put_contents($fileName,$contents);}return $fileName;}function CreateActionFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$ModuleUrl=str_replace(" ","-",$ModuleName).".php";$PageName_with_out_gap=str_replace(" ","_",$pageName);$name=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$TableID=$ModuleName_with_out_gap."_".$PageName_with_out_gap."_id";$TableNameToAdd="tbl_".strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;$name.=".php";$fileName="../".$ModuleName."/Action/Action".$name."";$CheckBoxAction=getFileDataPage('../pages/pageTemplates/checkBoxAction.php');$FileNameIfAttachemnt="";$CheckBoxActionPlaceHolder="";$FileAction=getFileDataPage('../pages/pageTemplates/FileUploadAction.php');$FileActionDelete=getFileDataPage('../pages/pageTemplates/FileDeleteAction.php');$FileActionPlaceHolder="";$FileActionDeletePlaceHolder="";foreach($dataArray as $page_data_detaiils_single){$DataTypesHtmlData="";foreach($page_data_detaiils_single['component']as $component_single){if($component_single['component_type']=='checkbox'){$CheckBoxActionPlaceHolder.=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$CheckBoxAction);}if($component_single['component_type']=='image'||$component_single['component_type']=='pdf_Documents'){$FileActionPlaceHolderDummy=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$FileAction);$FileActionPlaceHolder.=str_replace('**ModuleName**',$ModuleName,$FileActionPlaceHolderDummy);$FileActionDeletePlaceHolderDummy=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$FileActionDelete);$FileActionDeletePlaceHolder.=str_replace('**ModuleName**',$ModuleName,$FileActionDeletePlaceHolderDummy);}}}if(!is_file($fileName)){$contents=getFileDataPage('../pages/pageTemplates/PageActionTemplate.php');$contents=str_replace('**TableName**',strtolower($TableNameToAdd),$contents);$contents=str_replace('**TableId**',$TableID,$contents);$contents=str_replace('**FileActionCode**',$FileActionPlaceHolder,$contents);$contents=str_replace('**FileActionDeleteFileCode**',$FileActionDeletePlaceHolder,$contents);$contents=str_replace('**CheckBoxCode**',$CheckBoxActionPlaceHolder,$contents);file_put_contents($fileName,$contents);}}function CreateFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$ModuleUrl=str_replace(" ","-",$ModuleName).".php";$PageName_with_out_gap=str_replace(" ","_",$pageName);$name=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$TableID=$ModuleName_with_out_gap."_".$PageName_with_out_gap."_id";$TableNameToAdd="tbl_".strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;$name.=".php";$fileName="../".$ModuleName."/".$name."";$TheadData="<th>**ComponnetName**</th>";$TBodyData=getFileDataPage('../pages/pageTemplates/TableTemplateTBody.php');$TBodyDataSelect=getFileDataPage('../pages/pageTemplates/TableTemplateTBodySelect.php');$TBodyDataSelectFromTable=getFileDataPage('../pages/pageTemplates/TableTemplateTBodySelectFromTable.php');$TBodyDataImage=getFileDataPage('../pages/pageTemplates/TableTemplateTBodyDataImage.php');$TheadDataPlaceHolder="";$TBodyDataPlaceHolder="";foreach($dataArray as $page_data_detaiils_single){$DataTypesHtmlData="";foreach($page_data_detaiils_single['component']as $component_single){$contents=getFileDataPage('../pages/ComponentsPage/'.$component_single['component_type'].'.php');$contents=str_replace('**ComponnetName**',$component_single['component_name'],$contents);$contents=str_replace('**DataType**',$component_single['component_type'],$contents);$contents=str_replace('**required**',(($component_single['is_required']=='')?'':'required'),$contents);$contents=str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$contents);$contents=str_replace('**TableName**',strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap,$contents);$TheadDataPlaceHolder.="\n".str_replace('**ComponnetName**',$component_single['component_name'],$TheadData);if($component_single['component_type']=='select'){$TBodyDataPlaceHolder.="\n".str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$TBodyDataSelect);}else if($component_single['component_type']=='image'){$TBodyDataPlaceHolder.="\n".str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$TBodyDataImage);}else if($component_single['component_type']=='select_from_existing_table'){if(isset($component_single['sub_componentTable'])){$selectTable=$component_single['sub_componentTable']['selectTable'];$selectValue=$component_single['sub_componentTable']['selectValue'];$selectDisplay=$component_single['sub_componentTable']['selectDisplay'];$contents=str_replace('**selectTable**',$selectTable,$contents);$contents=str_replace('**selectValue**',$selectValue,$contents);$contents=str_replace('**selectDisplay**',$selectDisplay,$contents);$ChangeData=str_replace('**selectTable**',$selectTable,$TBodyDataSelectFromTable);$ChangeData=str_replace('**selectValue**',$selectValue,$ChangeData);$ChangeData=str_replace('**selectDisplay**',$selectDisplay,$ChangeData);$TBodyDataPlaceHolder.="\n".str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$ChangeData);}}else{$TBodyDataPlaceHolder.="\n".str_replace('**ComponnetNameWithDash**',str_replace(" ","_",$component_single['component_name']),$TBodyData);}$DataTypesHtmlData.="\n".$contents;}}if($TheadDataPlaceHolder!=''&&$TBodyDataPlaceHolder!=''){$TheadDataPlaceHolder.="<th>Edit</th>\n<th>Delete</th>";$TBodyDataPlaceHolder.=getFileDataPage('../pages/pageTemplates/TableTemplateTFoot.php');}if(!is_file($fileName)){$contents=getFileDataPage('../pages/pageTemplates/page_template.php');$contents=str_replace('**ModuleUrl**',$ModuleUrl,$contents);$contents=str_replace('**ModuleName**',$ModuleName,$contents);$contents=str_replace('**pageHeading**',ucwords($pageName),$contents);$contents=str_replace('**pageNameUrl**',$ModuleName_with_out_gap."_".$PageName_with_out_gap,$contents);$contents=str_replace('**contentPlaceHolder**',$DataTypesHtmlData,$contents);$contents=str_replace('**TableHeadValues**',$TheadDataPlaceHolder,$contents);$contents=str_replace('**TableBodyValues**',$TBodyDataPlaceHolder,$contents);$contents=str_replace('**TableName**',strtolower($TableNameToAdd),$contents);$contents=str_replace('**TableId**',$TableID,$contents);file_put_contents($fileName,$contents);}}function CreateTableForThisPage($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$PageName_with_out_gap=str_replace(" ","_",$pageName);$TableName=strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;foreach($dataArray as $page_data_detaiils_single){$data_array=array();$SubDataArray=array();foreach($page_data_detaiils_single['component']as $component_single){$DataType=$obj->select_any_one("tbl_type","type_name='".$component_single['component_type']."'");$data_array[]=array('Column_Name'=>str_replace(" ","_",$component_single['component_name']),'Datatype'=>$DataType['data_type']);}CreateTable(strtolower($TableName),$data_array,$obj);foreach($page_data_detaiils_single['component']as $component_single){if(isset($component_single['sub_component'])){$SubDataArray=array();$SubDataTableName=strtolower($TableName)."_".str_replace(" ","_",$component_single['component_name']);$SubDataArray[]=array('Column_Name'=>'value','Datatype'=>'varchar(100) NOT NULL');CreateTable($SubDataTableName,$SubDataArray,$obj);foreach($component_single['sub_component']as $values){$SubDataTableName_toadd="tbl_".$SubDataTableName;$sql="INSERT INTO `".$SubDataTableName_toadd."`(`value`) VALUES ('".$values."')";$obj->execute($sql);}}}}}function CreateTable($TableName,$arryWithFeildNameAndDataType,$obj){$idOfTable=strtolower($TableName)."_id";$TableName="tbl_".strtolower($TableName);$Column_NameAndDatatype=array();foreach($arryWithFeildNameAndDataType as $singleData){$Column_NameAndDatatype[]="`".$singleData['Column_Name']."` ".$singleData['Datatype'];}$Column_NameAndDatatypeString=implode(',',$Column_NameAndDatatype);$CreateTableString="CREATE TABLE ".strtolower($TableName)." (".$idOfTable." INT(11) UNSIGNED AUTO_INCREMENT PRIMARY KEY,";$CreateTableString.=$Column_NameAndDatatypeString;$CreateTableString.=") ENGINE=InnoDB DEFAULT CHARSET=utf8;";$obj->execute($CreateTableString);}function getFileDataPage($path_with_file_name){$getFileData=file_get_contents($path_with_file_name);if($getFileData!=''){return $getFileData;}else{return 0;}}function CreatePageInsideFolder($folderPath,$ModuleName,$dataArray){$name=str_replace(" ","_",$ModuleName);$name.=".php";$fileName=$folderPath.'/'.$name;if(!is_file($fileName)){$contents=getFileDataPage('../templates/content.php');$contents=str_replace('**itemName**',$ModuleName,$contents);file_put_contents($fileName,$contents);}}function CreatePageFileInsidePublicFolder($ModuleName,$pageName,$jsFile){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$PageName_with_out_gap=str_replace(" ","_",$pageName);$fileName=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$fileName.=".php";$fileNameWithPath='../public/'.$fileName;if(!is_file($fileNameWithPath)){$contents=getFileDataPage('../pages/pageTemplates/PublicPageTempplate.php');$contents=str_replace('**fileName**',$fileName,$contents);$contents=str_replace('**dateCreated**',date('d F Y'),$contents);$contents=str_replace('**path_to_be_added**',$ModuleName.'/'.$fileName,$contents);$contents=str_replace('**JsFile**',$jsFile,$contents);file_put_contents($fileNameWithPath,$contents);}}function AddPagesUrlToHtaccessFile($ModuleName,$pageName){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$PageName_with_out_gap=str_replace(" ","_",$pageName);$fileName=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$fileName.=".php";$fileNameWithOutExtention=$ModuleName_with_out_gap."-".$PageName_with_out_gap;$AddNewLineData="\nRewriteRule ^".$fileNameWithOutExtention."?$ ".$fileName.""."\n";$GetFile="../public/.htaccess";file_put_contents($GetFile,$AddNewLineData,FILE_APPEND|LOCK_EX);$contents=file_get_contents($GetFile);$contents=str_replace("\n\n","\n",$contents);file_put_contents($GetFile,$contents);}function RemoveFilesFromPages($ModuleName,$pageName,$dataArray,$obj){$folderPath="../".$ModuleName."";$jsFile=RemovePageJsFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj);RemoveTableForThisPage($ModuleName,$pageName,$dataArray,$obj);RemoveFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj);RemoveActionFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj);RemoveFileInsidePublicFolder($ModuleName,$pageName,$jsFile);RemovePagesUrlToHtaccessFile($ModuleName,$pageName);}function RemovePageJsFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$ModuleUrl=str_replace(" ","-",$ModuleName).".php";$PageName_with_out_gap=str_replace(" ","_",$pageName);$name=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$TableID=$ModuleName_with_out_gap."_".$PageName_with_out_gap."_id";$TableNameToAdd="tbl_".strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;$name.=".js";$fileName="../".$ModuleName."/js/".$name."";unlink($fileName);return $fileName;}function RemoveActionFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$ModuleUrl=str_replace(" ","-",$ModuleName).".php";$PageName_with_out_gap=str_replace(" ","_",$pageName);$name=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$TableID=$ModuleName_with_out_gap."_".$PageName_with_out_gap."_id";$TableNameToAdd="tbl_".strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;$name.=".php";$fileName="../".$ModuleName."/Action/Action".$name."";unlink($fileName);}function RemoveFileInsideModuleFolder($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$ModuleUrl=str_replace(" ","-",$ModuleName).".php";$PageName_with_out_gap=str_replace(" ","_",$pageName);$name=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$TableID=$ModuleName_with_out_gap."_".$PageName_with_out_gap."_id";$TableNameToAdd="tbl_".strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;$name.=".php";$fileName="../".$ModuleName."/".$name."";unlink($fileName);}function RemoveTableForThisPage($ModuleName,$pageName,$dataArray,$obj){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$PageName_with_out_gap=str_replace(" ","_",$pageName);$TableName=strtolower($ModuleName_with_out_gap)."_".$PageName_with_out_gap;foreach($dataArray[0]as $page_data_detaiils_single){foreach($page_data_detaiils_single['component']as $component_single){if(isset($component_single['sub_component'])){$SubDataTableName=strtolower($TableName)."_".str_replace(" ","_",$component_single['component_name']);$sql="DROP TABLE tbl_".$SubDataTableName.";";$obj->execute($sql);}}}$sql="DROP TABLE tbl_".$TableName.";";$obj->execute($sql);}function RemoveFileInsidePublicFolder($ModuleName,$pageName,$jsFile){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$PageName_with_out_gap=str_replace(" ","_",$pageName);$fileName=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$fileName.=".php";$fileNameWithPath='../public/'.$fileName;unlink($fileNameWithPath);}function RemovePagesUrlToHtaccessFile($ModuleName,$pageName){$ModuleName_with_out_gap=str_replace(" ","_",$ModuleName);$PageName_with_out_gap=str_replace(" ","_",$pageName);$fileName=$ModuleName_with_out_gap."_".$PageName_with_out_gap;$fileName.=".php";$fileNameWithOutExtention=$ModuleName_with_out_gap."-".$PageName_with_out_gap;$RemoveNewLineData="RewriteRule ^".$fileNameWithOutExtention."?$ ".$fileName.""."";$GetFile="../public/.htaccess";$contents=file_get_contents($GetFile);$contents=str_replace($RemoveNewLineData,'',$contents);file_put_contents($GetFile,$contents);} ?>